export default function app(){const open=document.getElementById("open"),span=document.querySelector("#open span"),overlay=document.querySelector(".overlay"),create=document.getElementById("create"),back=document.getElementById("back"),warn=document.getElementById("warning"),taskDiv=document.querySelector(".cinput");open.addEventListener("mouseenter",()=>{[open,span].forEach(e=>e.classList.add("abre"))}),open.addEventListener("mouseleave",()=>{[open,span].forEach(e=>e.classList.remove("abre"))}),open.addEventListener("click",()=>{[overlay,taskDiv].forEach(e=>e.classList.add("ativo")),setTimeout(()=>create.focus(),100)}),back.addEventListener("click",()=>{[overlay,warn,taskDiv].forEach(e=>e.classList.remove("ativo")),document.getElementById("create").value=""}),window.addEventListener("click",e=>{overlay.contains(e.target)||open.contains(e.target)||([overlay,warn,taskDiv].forEach(e=>e.classList.remove("ativo")),document.getElementById("create").value="")});const openConfig=document.getElementById("open-config"),configSpan=document.querySelector("#open-config span"),configBack=document.querySelector("#config-back"),configOverlay=document.getElementById("config-overlay"),refreshPage=document.getElementById("refresh"),clearData=document.getElementById("clearData"),configAviso=document.getElementById("config-aviso"),configDiv=document.getElementById("configs");openConfig.addEventListener("mouseenter",()=>{[openConfig,configSpan].forEach(e=>e.classList.add("abre"))}),openConfig.addEventListener("mouseleave",()=>{[openConfig,configSpan].forEach(e=>e.classList.remove("abre"))}),openConfig.addEventListener("click",()=>{[configOverlay,configDiv].forEach(e=>e.classList.add("ativo"))}),configBack.addEventListener("click",()=>{[configOverlay,configAviso,configDiv].forEach(e=>e.classList.remove("ativo"))}),window.addEventListener("click",e=>{configOverlay.contains(e.target)||openConfig.contains(e.target)||[configOverlay,configAviso,configDiv].forEach(e=>e.classList.remove("ativo"))}),refreshPage.addEventListener("click",()=>{window.location.reload()}),clearData.addEventListener("click",e=>{configAviso.classList.contains("ativo")?setTimeout(()=>{localStorage.clear(),refreshPage.click()},200):configAviso.classList.add("ativo")});let taskList=document.querySelector(".tasks ul"),tasks,dragList,local,complete;function updateList(){dragList=taskList.querySelectorAll(".task"),tasks=[].slice.call(taskList.querySelectorAll(".task"),0)}function updateLS(){local=[],complete=[];let ativas=document.querySelectorAll("li.task:not(.completo)"),completas=taskList.querySelectorAll("li.task.completo");0==completas.length?localStorage.removeItem("complete"):completas.forEach(e=>{complete.push(e.outerHTML),localStorage.setItem("complete",complete)}),0==ativas.length?localStorage.removeItem("tasks"):ativas.forEach(e=>{local.push(e.outerHTML),localStorage.setItem("tasks",local)})}const itemLeft=document.querySelector(".clear p");function postTask(texto,completo,categ){let tasktext=texto,classe,categoria=categ;if(tasktext&&completo){let newTask=document.createElement("li");newTask.classList.add("task"),newTask.setAttribute("draggable","true"),newTask.classList.add(completo),newTask.innerHTML=`\n        <div>\n            <button id="checa"></button>\n          <p>${tasktext}</p>\n        </div>\n        <button class="close"></button>\n        `,taskList.append(newTask),itemLeft.innerText=`${taskList.children.length} tarefa(s) ativa(s)`}else newTask=document.createElement("li"),newTask.classList.add("task"),newTask.classList.add(categoria),newTask.setAttribute("draggable","true"),newTask.innerHTML=`\n        <div>\n            <button id="checa"></button>\n          <p>${tasktext}</p>\n        </div>\n        <button class="close"></button>\n        `,taskList.append(newTask),itemLeft.innerText=`${taskList.children.length} tarefa(s) ativa(s)`;updateList()}function postSavedTask(html){let fromLocalStorage=html,savedTask=document.createElement("li");taskList.append(savedTask),savedTask.outerHTML=`${fromLocalStorage}`,itemLeft.innerText=`${taskList.children.length} tarefa(s) ativa(s)`,updateList()}let active=document.getElementById("active"),completed=document.getElementById("completed");function sort(){let completedTasks=document.querySelectorAll("li.task.completo"),activeTasks=document.querySelectorAll("li.task:not(.completo)");active.classList.contains("sorted")?(completedTasks.forEach(e=>e.style.display="none"),activeTasks.forEach(e=>e.style.display="flex"),itemLeft.innerText=`${activeTasks.length} tarefa(s) ativa(s)`,clearCompleted.style.visibility="hidden"):(activeTasks.forEach(e=>e.style.display="none"),completedTasks.forEach(e=>e.style.display="flex"),itemLeft.innerText=`${completedTasks.length} tarefa(s) completa(s)`,clearCompleted.style.visibility="visible")}[active,completed].forEach(e=>{e.addEventListener("click",evt=>{[active,completed].forEach(e=>e.classList.remove("sorted")),evt.currentTarget==active?(active.classList.add("sorted"),clearCompleted.style.visibility="hidden"):evt.currentTarget==completed&&(completed.classList.add("sorted"),clearCompleted.style.visibility="visible"),sort()})});let showcateg=document.getElementById("showcateg"),index;function showCateg(categSelected){let valor=categSelected,completedTasks=document.querySelectorAll("li.task.completo"),activeTasks=document.querySelectorAll("li.task:not(.completo)"),completas=document.querySelectorAll(`li.task.completo.${valor}`),ativas=document.querySelectorAll(`li.task:not(.completo).${valor}`);"todas"!==showcateg.value?([...completedTasks,...activeTasks].forEach(e=>e.style.display="none"),[...completas,...ativas].forEach(e=>e.style.display="flex"),[active,completed].forEach(e=>e.disabled=!0)):([...completedTasks].forEach(e=>e.style.display="none"),[...activeTasks].forEach(e=>e.style.display="flex"),[active,completed].forEach(e=>e.disabled=!1))}function completeTask(){complete=[];let completas=taskList.querySelectorAll("li.task.completo");-1!==index&&(tasks[index].classList.add("move"),tasks[index].classList.toggle("completo"),itemLeft.innerText=`${taskList.children.length-completas.length} tarefa(s) ativa(s)`,tasks[index].classList.contains("completo")?tasks[index].removeAttribute("draggable"):tasks[index].setAttribute("draggable","draggable")),showcateg.value="todas",[active,completed].forEach(e=>e.disabled=!1)}showcateg.addEventListener("change",()=>{let valor;showCateg(showcateg.value)}),taskList.addEventListener("click",evt=>{if("LI"===evt.target.nodeName){if(index=tasks.indexOf(evt.target),completeTask(),evt.target.matches(".close")){let item=evt.target.parentElement;taskList.removeChild(item),itemLeft.innerText=`${taskList.children.length} tarefa(s) ativa(s)`,updateList()}sort(),updateLS()}else{if(index=tasks.indexOf(evt.target.closest("li.task")),completeTask(),evt.target.matches(".close")){let item=evt.target.parentElement;taskList.removeChild(item),itemLeft.innerText=`${taskList.children.length} tarefa(s) ativa(s)`,updateList()}sort(),updateLS()}setTimeout(()=>{let completas;taskList.querySelectorAll("li.task.completo").forEach(e=>e.classList.remove("move"))},500)});let clearCompleted=document.getElementById("clear");clearCompleted.addEventListener("click",()=>{let completedTasks;document.querySelectorAll("li.task.completo").forEach(e=>taskList.removeChild(e)),itemLeft.innerText=`${taskList.children.length} tarefa(s) ativa(s)`,updateList(),updateLS()});let dragged=null;function handleDragStart(e){this.style.filter="brightness(50%)",dragged=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.outerHTML),e.dataTransfer.setData("text/text","id")}function handleDragOver(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function handleDragEnter(e){this.classList.add("over")}function handleDragLeave(e){updateList(),this.classList.remove("over")}function handleDrop(e){return e.preventDefault&&e.preventDefault(),dragged!=this&&(dragged.outerHTML=this.outerHTML,this.outerHTML=e.dataTransfer.getData("text/html")),!1}function handleDragEnd(e){updateList(),dragList.forEach(each=>{each.style.filter="brightness(100%)",each.classList.remove("over")})}setTimeout(()=>{let draggable;document.querySelectorAll("li.task:not(.completo)").forEach(item=>{item.addEventListener("dragstart",handleDragStart,!1),item.addEventListener("dragenter",handleDragEnter,!1),item.addEventListener("dragover",handleDragOver,!1),item.addEventListener("dragleave",handleDragLeave,!1),item.addEventListener("drop",handleDrop,!1),item.addEventListener("dragend",handleDragEnd,!1)})},400),window.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{let lista=document.querySelectorAll("li.task:not(.completo)");lista.forEach(e=>e.style.display="flex"),itemLeft.innerText=`${lista.length} tarefa(s) ativa(s)`},100);let notouchWarning=document.getElementById("notouch"),MutationObserver,observer;if("ontouchstart"in window?notouchWarning.classList.add("notouch"):notouchWarning.classList.remove("notouch"),"tasks"in localStorage){let tasks=localStorage.getItem("tasks"),cleaned=Array.from(tasks.split(","));for(let i=0;i<cleaned.length;i++){let texto;postSavedTask(cleaned[i])}}if("complete"in localStorage){let complete=localStorage.getItem("complete"),cleaned=Array.from(complete.split(","));for(let i=0;i<cleaned.length;i++){let texto;postSavedTask(cleaned[i])}}new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(mutations=>{mutations.forEach(()=>{setTimeout(()=>{let draggable;document.querySelectorAll("li.task:not(.completo)").forEach(item=>{item.addEventListener("dragstart",handleDragStart,!1),item.addEventListener("dragenter",handleDragEnter,!1),item.addEventListener("dragover",handleDragOver,!1),item.addEventListener("dragleave",handleDragLeave,!1),item.addEventListener("drop",handleDrop,!1),item.addEventListener("dragend",handleDragEnd,!1)})},400)})}).observe(taskList,{childList:!0})});const post=document.getElementById("post"),createcateg=document.getElementById("createcateg");post.addEventListener("click",()=>{let valor=create.value,categ=createcateg.value;if(valor.length&&"hide"!==categ){if(warn.classList.remove("ativo"),completed.classList.remove("sorted"),sort(),postTask(valor,categ),create.value="",updateLS(),[overlay,warn,taskDiv].forEach(e=>e.classList.remove("ativo")),!overlay.classList.contains("ativo")){let options=Array.from(createcateg.querySelectorAll("option"));createcateg.value=options[0].value}}else warn.classList.add("ativo")}),window.addEventListener("keyup",evt=>{13==evt.keyCode&&post.click()})}